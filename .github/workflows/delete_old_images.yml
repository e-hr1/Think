name: Delete All Docker Images from Docker Hub

on:
  workflow_dispatch:  # يمكن تشغيله يدويًا

jobs:
  delete-images:
    runs-on: ubuntu-latest
    steps:
      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_HUB_USERNAME }}
          password: ${{ secrets.DOCKER_HUB_TOKEN }}

      - name: Fetch and Delete Tags
        run: |
          REPO="e-hr1/think"  # استبدل باسم مستودعك في Docker Hub
          TAGS=$(curl -s -H "Authorization: Bearer ${{ secrets.CLEANUP_TOKEN }}" \
            "https://hub.docker.com/v2/repositories/$REPO/tags/?page_size=100" | jq -r '.results[].name')

          for TAG in $TAGS; do
            echo "Deleting $REPO:$TAG"
            curl -X DELETE -H "Authorization: Bearer ${{ secrets.DOCKER_HUB_TOKEN }}" \
              "https://hub.docker.com/v2/repositories/$REPO/tags/$TAG/"
          done
