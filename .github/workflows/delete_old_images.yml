name: Auto Delete Old Images

on:
  schedule:
    - cron: '*/5 * * * *'  # ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
  workflow_dispatch:        # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      # Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙŠØ¨Ùˆ
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0    # Ù…Ù‡Ù… Ù„Ø±Ø¤ÙŠØ© ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù„ÙØ§Øª
          token: ${{ secrets.CLEANUP_TOKEN }}

      # Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø­Ø°Ù Ø§Ù„ØµÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      - name: Remove old images
        run: |
          echo "ğŸ“ Cleaning up images older than 5 minutes..."
          find images/ -type f \( -name "*.jpg" -o -name "*.png" -o -name "*.jpeg" \) -mmin +5 -print -delete
          echo "âœ… Done!"

      # Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
      - name: Commit changes
        if: success()
        run: |
          git config user.name "GitHub Cleanup Bot"
          git config user.email "actions@github.com"
          git add images/
          git diff --quiet || (git commit -m "ğŸ”„ Auto-delete: Removed old images" && git push)
