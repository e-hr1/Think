name: Auto Delete Old Images

on:
  schedule:
    - cron: '*/5 * * * *'  # كل 5 دقائق
  workflow_dispatch:        # تشغيل يدوي

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      # الخطوة 1: تحميل الريبو
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0    # مهم لرؤية تواريخ الملفات
          token: ${{ secrets.CLEANUP_TOKEN }}

      # الخطوة 2: حذف الصور القديمة
      - name: Remove old images
        run: |
          echo "📁 Cleaning up images older than 5 minutes..."
          find images/ -type f \( -name "*.jpg" -o -name "*.png" -o -name "*.jpeg" \) -mmin +5 -print -delete
          echo "✅ Done!"

      # الخطوة 3: حفظ التغييرات
      - name: Commit changes
        if: success()
        run: |
          git config user.name "GitHub Cleanup Bot"
          git config user.email "actions@github.com"
          git add images/
          git diff --quiet || (git commit -m "🔄 Auto-delete: Removed old images" && git push)
