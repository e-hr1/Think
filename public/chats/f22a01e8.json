{"title":"معاينة المشاركة قبل التأكيد","messages":[{"text":"import 'package:flutter/material.dart';\nimport '../l10n/app_localizations.dart'; // تأكد من صحة هذا المسار\n\nclass SharePreviewSheet extends StatelessWidget {\n  final String conversationTitle;\n  final String? userMessage;\n  final String? aiMessage;\n  final VoidCallback onConfirm;\n\n  const SharePreviewSheet({\n    super.key,\n    required this.conversationTitle,\n    this.userMessage,\n    this.aiMessage,\n    required this.onConfirm,\n  });\n\n  @override\n  Widget build(BuildContext context) {\n    final l10n = AppLocalizations.of(context)!;\n    final isDarkMode = Theme.of(context).brightness == Brightness.dark;\n    final textColor = Theme.of(context).textTheme.bodyLarge?.color;\n    final secondaryTextColor = Colors.grey[600];\n    final sheetColor = Theme.of(context).cardColor;\n\n    // استخدام SafeArea لضمان عدم تداخل الواجهة مع عناصر النظام في الأسفل\n    return SafeArea(\n      child: Padding(\n        // إضافة padding أفقي لتجنب الالتصاق بحواف الشاشة\n        padding: const EdgeInsets.symmetric(horizontal: 16.0),\n        child: Column(\n          mainAxisSize: MainAxisSize.min,\n          children: [\n            const SizedBox(height: 8),\n            // 1. النمشة الصغيرة (Handle)\n            Container(\n              width: 40,\n              height: 5,\n              decoration: BoxDecoration(\n                color: Colors.grey.shade400,\n                borderRadius: BorderRadius.circular(10),\n              ),\n            ),\n            const SizedBox(height: 20),\n\n            // 2. الحاوية الرئيسية مع الظل\n            Container(\n              decoration: BoxDecoration(\n                color: sheetColor,\n                borderRadius: BorderRadius.circular(16.0),\n                boxShadow: [\n                  BoxShadow(\n                    color: Colors.black.withOpacity(0.08),\n                    blurRadius: 20,\n                    offset: const Offset(0, 4),\n                  ),\n                ],\n              ),\n              child: Column(\n                children: [\n                  // 3. عنوان المحادثة والخط الصغير\n                  Padding(\n                    padding: const EdgeInsets.fromLTRB(16, 16, 16, 12),\n                    child: Column(\n                      crossAxisAlignment: CrossAxisAlignment.start,\n                      children: [\n                        Text(\n                          conversationTitle,\n                          style: TextStyle(\n                            fontWeight: FontWeight.bold,\n                            fontSize: 17,\n                            color: textColor,\n                          ),\n                          maxLines: 1,\n                          overflow: TextOverflow.ellipsis,\n                        ),\n                        const SizedBox(height: 8),\n                        Container(\n                          height: 1,\n                          color: isDarkMode ? Colors.grey.shade800 : Colors.grey.shade200,\n                        ),\n                      ],\n                    ),\n                  ),\n\n                  // 4. رسالة المستخدم (بتصميم مشابه للدردشة)\n                  if (userMessage != null && userMessage!.isNotEmpty)\n                    _buildMessageBubble(\n                      context: context,\n                      message: userMessage!,\n                      isUser: true,\n                      isDarkMode: isDarkMode,\n                    ),\n\n                  // 5. رسالة الذكاء الاصطناعي (بتصميم مشابه للدردشة)\n                  if (aiMessage != null && aiMessage!.isNotEmpty)\n                    _buildMessageBubble(\n                      context: context,\n                      message: aiMessage!,\n                      isUser: false,\n                      isDarkMode: isDarkMode,\n                    ),\n                  \n                  const SizedBox(height: 16),\n                ],\n              ),\n            ),\n            const SizedBox(height: 24),\n\n            // 6. زر المشاركة الممتد\n            SizedBox(\n              width: double.infinity,\n              child: ElevatedButton(\n                onPressed: () {\n                  Navigator.of(context).pop();\n                  onConfirm();\n                },\n                style: ElevatedButton.styleFrom(\n                  padding: const EdgeInsets.symmetric(vertical: 16),\n                  backgroundColor: const Color(0xFF4D6BFF),\n                  foregroundColor: Colors.white,\n                  elevation: 0,\n                  shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),\n                ),\n                child: Text(\n                  l10n.share, // \"مشاركة\"\n                  style: const TextStyle(fontWeight: FontWeight.bold, fontSize: 16),\n                ),\n              ),\n            ),\n            const SizedBox(height: 16),\n\n            // 7. النص التحذيري الصغير\n            Padding(\n              padding: const EdgeInsets.symmetric(horizontal: 8.0),\n              child: Text(\n                l10n.shareWarningMessage, // النص الجديد\n                textAlign: TextAlign.center,\n                style: TextStyle(\n                  fontSize: 12,\n                  color: secondaryTextColor,\n                ),\n              ),\n            ),\n            const SizedBox(height: 16),\n          ],\n        ),\n      ),\n    );\n  }\n\n  // ويدجت مساعد لبناء فقاعة الرسالة بالستايل المطلوب\n  Widget _buildMessageBubble({\n    required BuildContext context,\n    required String message,\n    required bool isUser,\n    required bool isDarkMode,\n  }) {\n    final bubbleColor = isUser\n        ? (isDarkMode ? const Color(0xFF2A3C5C) : const Color(0xFFECF2FE))\n        : (isDarkMode ? const Color(0xFF2D2F31) : const Color(0xFFF1F1F1));\n    \n    final bubbleTextColor = isUser\n        ? (isDarkMode ? Colors.white : Colors.black)\n        : Theme.of(context).textTheme.bodyLarge?.color;\n\n    final icon = isUser ? Icons.person : null;\n    final iconPath = isUser ? null : 'assets/icon_thinkapp.png';\n\n    return Padding(\n      padding: const EdgeInsets.symmetric(horizontal: 16.0, vertical: 6.0),\n      child: Row(\n        crossAxisAlignment: CrossAxisAlignment.start,\n        children: [\n          // الأيقونة\n          if (icon != null)\n            Icon(icon, size: 24, color: Colors.grey[600])\n          else if (iconPath != null)\n            Image.asset(iconPath, width: 24, height: 24),\n          \n          const SizedBox(width: 10),\n          \n          // الفقاعة\n          Flexible(\n            child: Container(\n              padding: const EdgeInsets.symmetric(horizontal: 14, vertical: 10),\n              decoration: BoxDecoration(\n                color: bubbleColor,\n                borderRadius: BorderRadius.circular(16),\n              ),\n              child: Text(\n                message,\n                style: TextStyle(fontSize: 15, color: bubbleTextColor),\n                maxLines: 3, // حد أقصى 3 أسطر للمعاينة\n                overflow: TextOverflow.ellipsis,\n              ),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n}","isUser":true,"timestamp":"2025-09-24T00:17:19.053","imageUrls":[],"attachedFiles":[]}]}