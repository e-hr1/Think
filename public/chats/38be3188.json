{"title":"عرض المحادثة: تعديلات على تنسيق الأكواد والجداول","messages":[{"text":"<!DOCTYPE html>\n<html lang=\"ar\" dir=\"rtl\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>عرض المحادثة</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js\"></script>\n\n    <style>\n        :root {\n            --bg-color: #f0f2f5; --text-color: #050505; --container-bg: #ffffff; --container-border: #e0e0e0; --header-bg: #f5f6f7; --header-border: #ddd; --bot-bubble-bg: transparent; --user-bubble-bg: #ECF2FE; --user-bubble-text: #050505; --timestamp-color: #65676b; --attachment-border: #ddd; --welcome-icon-filter: none;\n            --code-bg: #f6f8fa;\n            --code-header-bg: #eef0f2;\n            --code-text-color: #24292e;\n            --table-border-color: #e0e0e0;\n            --table-header-bg: #f9f9f9;\n            --table-row-hover: #f1f1f1;\n        }\n        .dark-mode {\n            --bg-color: #18191a; --text-color: #e4e6eb; --container-bg: #242526; --container-border: #3a3b3c; --header-bg: #3a3b3c; --header-border: #444; --bot-bubble-bg: transparent; --user-bubble-bg: #2A3C5C; --user-bubble-text: #e4e6eb; --timestamp-color: #b0b3b8; --attachment-border: #444;\n            --code-bg: #1e1e1e;\n            --code-header-bg: #333;\n            --code-text-color: #d4d4d4;\n            --table-border-color: #444;\n            --table-header-bg: #3a3b3c;\n            --table-row-hover: #4a4b4c;\n        }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n            background-color: var(--bg-color);\n            color: var(--text-color);\n            margin: 0;\n            height: 100vh;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .chat-container {\n            width: 100%;\n            max-width: 800px;\n            background-color: var(--container-bg);\n            border-radius: 8px;\n            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n            height: 100%;\n            max-height: 100vh;\n        }\n        .chat-header {\n            padding: 15px 20px;\n            border-bottom: 1px solid var(--header-border);\n            background-color: var(--header-bg);\n            text-align: center;\n            flex-shrink: 0;\n        }\n        .chat-header h1 {\n            margin: 0;\n            font-size: 15px;\n            font-weight: 600;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n        .chat-body {\n            flex-grow: 1;\n            overflow-y: auto;\n            padding: 10px 8px;\n        }\n        .message {\n            display: flex;\n            margin-bottom: 4px;\n            max-width: 95%;\n        }\n        .message.user {\n            margin-left: auto;\n            flex-direction: row-reverse;\n        }\n        .message.bot {\n            margin-right: auto;\n            align-items: flex-start;\n            gap: 8px;\n        }\n        .bot-avatar {\n            width: 28px;\n            height: 28px;\n            border-radius: 50%;\n            flex-shrink: 0;\n            margin-top: 4px;\n        }\n        .message-wrapper {\n            display: flex;\n            flex-direction: column;\n            max-width: 100%;\n            overflow: hidden;\n        }\n        .message.user .message-wrapper { align-items: flex-end; }\n        .message.bot .message-wrapper { align-items: flex-start; }\n        .bubble {\n            padding: 12px;\n            border-radius: 18px;\n            line-height: 1.5;\n            white-space: pre-wrap;\n            word-wrap: break-word;\n        }\n        .message.user .bubble {\n            background-color: var(--user-bubble-bg);\n            color: var(--user-bubble-text);\n        }\n        .message.bot .bubble {\n            background-color: var(--bot-bubble-bg);\n            color: var(--text-color);\n        }\n        .message.bot .bubble p { margin: 0 0 8px 0; }\n        .message.bot .bubble p:last-child { margin-bottom: 0; }\n        .message.bot .bubble ul, .message.bot .bubble ol { margin: 8px 0; padding-right: 20px; }\n        .message.bot .bubble li { margin-bottom: 4px; }\n        .message.bot .bubble a { color: #007bff; text-decoration: underline; }\n        .message.bot .bubble strong { font-weight: bold; }\n        .message.bot .bubble em { font-style: italic; }\n        .message.bot .bubble code {\n            font-family: 'monospace';\n            background-color: rgba(0,0,0,0.05);\n            padding: 2px 4px;\n            border-radius: 4px;\n        }\n        .dark-mode .message.bot .bubble code { background-color: rgba(255,255,255,0.1); }\n        .timestamp {\n            font-size: 0.75em;\n            color: var(--timestamp-color);\n            padding: 4px 12px;\n        }\n        .status-message {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--timestamp-color);\n            font-size: 1.1em;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            height: 100%;\n        }\n        .attachments-container {\n            padding: 0 12px;\n            margin-top: 8px;\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        .message-images {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 4px;\n            max-width: 250px;\n        }\n        .message-images img {\n            width: 120px;\n            height: 120px;\n            object-fit: cover;\n            border-radius: 16px;\n            border: 0.5px solid var(--attachment-border);\n            cursor: default;\n            transition: transform 0.2s;\n        }\n        .message-images img:hover {\n            transform: scale(1.05);\n        }\n        .file-attachment {\n            display: flex;\n            align-items: center;\n            padding: 10px 12px;\n            border-radius: 12px;\n            border: 0.5px solid var(--attachment-border);\n            width: 220px;\n            box-sizing: border-box;\n        }\n        .file-attachment img {\n            width: 40px;\n            height: 40px;\n            margin-left: 8px;\n        }\n        .file-info {\n            overflow: hidden;\n            flex-grow: 1;\n        }\n        .file-info .name {\n            font-size: 14px;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            color: var(--text-color);\n        }\n        .file-info .size {\n            font-size: 11px;\n            color: #65676b;\n        }\n        .dark-mode .file-info .size { color: #a0a0a0; }\n\n        /* --- بداية تنسيقات الجداول والأكواد --- */\n\n        /* حاوية الجداول لجعلها قابلة للتمرير الأفقي */\n        .table-wrapper {\n            overflow-x: auto;\n            margin: 1em 0;\n            border: 1px solid var(--table-border-color);\n            border-radius: 8px;\n        }\n        .message.bot .bubble table {\n            width: 100%;\n            border-collapse: collapse;\n            font-size: 0.9em;\n            min-width: 500px; /* يضمن أن الجدول لا ينضغط أكثر من اللازم */\n        }\n        .message.bot .bubble th, .message.bot .bubble td {\n            padding: 12px 15px;\n            text-align: right;\n            border-bottom: 1px solid var(--table-border-color);\n            white-space: nowrap; /* يمنع التفاف النصوص داخل الخلايا */\n        }\n        .message.bot .bubble th {\n            background-color: var(--table-header-bg);\n            font-weight: 600;\n            color: var(--text-color);\n        }\n        .message.bot .bubble tr:last-of-type td {\n            border-bottom: none;\n        }\n        .message.bot .bubble tr:hover {\n            background-color: var(--table-row-hover);\n        }\n\n        /* تنسيق بلوكات الأكواد */\n        .message.bot .bubble pre {\n            background-color: var(--code-bg);\n            border-radius: 8px;\n            margin: 16px 0;\n            overflow: hidden; /* لإخفاء زوايا code الداخلية */\n            direction: ltr;\n            position: relative;\n            border: 1px solid var(--table-border-color);\n        }\n        .code-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            background-color: var(--code-header-bg);\n            padding: 8px 12px;\n            color: #586069;\n            font-size: 0.8em;\n            border-bottom: 1px solid var(--table-border-color);\n        }\n        .dark-mode .code-header {\n            color: #ccc;\n        }\n        .copy-button {\n            background-color: #f6f8fa;\n            color: #24292e;\n            border: 1px solid rgba(27, 31, 35, 0.15);\n            padding: 5px 10px;\n            border-radius: 5px;\n            cursor: pointer;\n            font-size: 0.9em;\n            transition: background-color 0.2s;\n        }\n        .dark-mode .copy-button {\n            background-color: #555;\n            color: white;\n            border-color: #666;\n        }\n        .copy-button:hover {\n            background-color: #eef0f2;\n        }\n        .dark-mode .copy-button:hover {\n            background-color: #666;\n        }\n        .copy-button.copied {\n            background-color: #28a745;\n            color: white;\n        }\n        .message.bot .bubble pre code {\n            display: block;\n            padding: 16px;\n            color: var(--code-text-color);\n            white-space: pre;\n            overflow-x: auto; /* هذا هو السطر المسؤول عن التمرير الأفقي للكود */\n            background-color: transparent;\n            font-family: 'SF Mono', 'Fira Code', 'Consolas', 'monospace';\n            font-size: 0.9em;\n            line-height: 1.6;\n        }\n        /* --- نهاية تنسيقات الجداول والأكواد --- */\n\n    </style>\n</head>\n<body>\n    <div class=\"chat-container\">\n        <div class=\"chat-header\"><h1 id=\"chat-title\">Think AI</h1></div>\n        <div class=\"chat-body\" id=\"chat-body\">\n            <!-- المحتوى سيتم إضافته هنا بواسطة JavaScript -->\n        </div>\n    </div>\n\n    <script>\n        document.addEventListener('DOMContentLoaded', function() {\n            const username = \"e-hr1\";\n            const repo = \"Think\";\n            const branch = \"main\";\n            const chatBody = document.getElementById('chat-body');\n            const chatTitle = document.getElementById('chat-title');\n\n            // التبديل للوضع المظلم بناءً على إعدادات النظام\n            const darkModeMatcher = window.matchMedia('(prefers-color-scheme: dark)');\n            function applyDarkMode(e) {\n                if (e.matches) {\n                    document.body.classList.add('dark-mode');\n                    document.querySelector('link[href*=\"highlight.js\"]').href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css';\n                } else {\n                    document.body.classList.remove('dark-mode');\n                    document.querySelector('link[href*=\"highlight.js\"]').href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';\n                }\n            }\n            darkModeMatcher.addListener(applyDarkMode);\n            applyDarkMode(darkModeMatcher);\n\n\n            const params = new URLSearchParams(window.location.search);\n            const chatId = params.get('id');\n\n            if (!chatId) {\n                window.location.href = 'welcome.html';\n                return;\n            }\n\n            chatBody.innerHTML = `<div class=\"status-message\"><p>جاري تحميل المحادثة...</p></div>`;\n            \n            const filePath = `public/chats/${chatId}.json`;\n            const fileUrl = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${filePath}`;\n\n            fetch(fileUrl)\n                .then(r => !r.ok ? new Promise(res => setTimeout(res, 1500)).then(() => fetch(fileUrl + '?t=' + new Date().getTime())) : r)\n                .then(r => { if (!r.ok) throw new Error(`فشل في العثور على المحادثة (الكود: ${r.status}).`); return r.json(); })\n                .then(conversation => displayConversation(conversation))\n                .catch(error => {\n                    console.error(error);\n                    const errorMessage = `حدث خطأ: ${error.message}`;\n                    window.location.href = `welcome.html?toast=${encodeURIComponent(errorMessage)}`;\n                });\n        });\n\n        function displayConversation(conversation) {\n            const chatTitle = document.getElementById('chat-title');\n            const chatBody = document.getElementById('chat-body');\n            chatTitle.textContent = conversation.title || 'محادثة';\n            chatBody.innerHTML = '';\n\n            if (!conversation.messages || conversation.messages.length === 0) {\n                const errorMessage = \"المحادثة فارغة أو تم حذفها.\";\n                window.location.href = `welcome.html?toast=${encodeURIComponent(errorMessage)}`;\n                return;\n            }\n\n            const username = \"e-hr1\";\n            const repo = \"Think\";\n            const branch = \"main\";\n            const botAvatarUrl = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/public/assets/icons/icon_thinkapp.png`;\n\n            function getIconUrl(fileType) {\n                const iconMap = {\n                    'pdf': 'icon_file_pdf.png', 'word': 'icon_word.png', 'excel': 'icon_exel.png',\n                    'pptx': 'icon_pptx.png', 'txt': 'icon_txt.png', 'code': 'icon_file_code.png'\n                };\n                const iconName = iconMap[fileType] || 'icon_file_code.png';\n                return `https://raw.githubusercontent.com/${username}/${repo}/${branch}/public/assets/icons/${iconName}`;\n            }\n\n            conversation.messages.forEach(msg => {\n                if (!msg.text && (!msg.imageUrls || msg.imageUrls.length === 0) && (!msg.attachedFiles || msg.attachedFiles.length === 0)) {\n                    return;\n                }\n\n                const messageEl = document.createElement('div');\n                messageEl.className = `message ${msg.isUser ? 'user' : 'bot'}`;\n\n                if (!msg.isUser) {\n                    const avatarImg = document.createElement('img');\n                    avatarImg.src = botAvatarUrl;\n                    avatarImg.className = 'bot-avatar';\n                    messageEl.appendChild(avatarImg);\n                }\n\n                const wrapperEl = document.createElement('div');\n                wrapperEl.className = 'message-wrapper';\n\n                const attachmentsEl = document.createElement('div');\n                attachmentsEl.className = 'attachments-container';\n\n                if (msg.imageUrls && msg.imageUrls.length > 0) {\n                    const imagesContainer = document.createElement('div');\n                    imagesContainer.className = 'message-images';\n                    if (msg.isUser) { imagesContainer.style.justifyContent = 'flex-end'; }\n                    msg.imageUrls.forEach(url => {\n                        const img = document.createElement('img');\n                        img.src = url;\n                        img.alt = 'صورة مرفقة';\n                        imagesContainer.appendChild(img);\n                    });\n                    attachmentsEl.appendChild(imagesContainer);\n                }\n\n                if (msg.attachedFiles && msg.attachedFiles.length > 0) {\n                    msg.attachedFiles.forEach(file => {\n                        const fileDiv = document.createElement('div');\n                        fileDiv.className = 'file-attachment';\n                        fileDiv.innerHTML = `\n                            <img src=\"${getIconUrl(file.type)}\" alt=\"${file.type} icon\">\n                            <div class=\"file-info\">\n                                <div class=\"name\">${file.name}</div>\n                                <div class=\"size\">${file.size}</div>\n                            </div>`;\n                        attachmentsEl.appendChild(fileDiv);\n                    });\n                }\n                \n                if (msg.isUser) { wrapperEl.appendChild(attachmentsEl); }\n\n                if (msg.text && msg.text.trim() !== '') {\n                    const bubbleEl = document.createElement('div');\n                    bubbleEl.className = 'bubble';\n                    \n                    if (msg.isUser) {\n                        bubbleEl.textContent = msg.text;\n                    } else {\n                        bubbleEl.innerHTML = marked.parse(msg.text, {\n                            highlight: function(code, lang) {\n                                const language = hljs.getLanguage(lang) ? lang : 'plaintext';\n                                return hljs.highlight(code, { language, ignoreIllegals: true }).value;\n                            }\n                        });\n                    }\n                    \n                    wrapperEl.appendChild(bubbleEl);\n                }\n                \n                if (!msg.isUser) { wrapperEl.appendChild(attachmentsEl); }\n\n                const timestampEl = document.createElement('div');\n                timestampEl.className = 'timestamp';\n                timestampEl.textContent = new Date(msg.timestamp).toLocaleString('ar-SA', { hour: 'numeric', minute: 'numeric', hour12: true });\n                wrapperEl.appendChild(timestampEl);\n\n                messageEl.appendChild(wrapperEl);\n                chatBody.appendChild(messageEl);\n            });\n\n            // استدعاء الدوال لتحسين عرض الأكواد والجداول\n            enhanceCodeBlocks();\n            wrapTables();\n        }\n\n        function enhanceCodeBlocks() {\n            document.querySelectorAll('.message.bot .bubble pre').forEach(preElement => {\n                if (preElement.querySelector('.code-header')) return; // تجنب إضافة الهيدر مرتين\n\n                const codeElement = preElement.querySelector('code');\n                if (!codeElement) return;\n\n                const langClass = Array.from(codeElement.classList).find(c => c.startsWith('language-'));\n                const lang = langClass ? langClass.replace('language-', '') : 'code';\n\n                const header = document.createElement('div');\n                header.className = 'code-header';\n\n                const langName = document.createElement('span');\n                langName.textContent = lang;\n\n                const copyButton = document.createElement('button');\n                copyButton.className = 'copy-button';\n                copyButton.textContent = 'نسخ';\n\n                header.appendChild(langName);\n                header.appendChild(copyButton);\n\n                preElement.insertBefore(header, preElement.firstChild);\n\n                copyButton.addEventListener('click', () => {\n                    navigator.clipboard.writeText(codeElement.innerText).then(() => {\n                        copyButton.textContent = 'تم النسخ!';\n                        copyButton.classList.add('copied');\n                        setTimeout(() => {\n                            copyButton.textContent = 'نسخ';\n                            copyButton.classList.remove('copied');\n                        }, 2000);\n                    });\n                });\n            });\n        }\n\n        function wrapTables() {\n            document.querySelectorAll('.message.bot .bubble table').forEach(table => {\n                if (table.parentNode.classList.contains('table-wrapper')) return;\n                const wrapper = document.createElement('div');\n                wrapper.className = 'table-wrapper';\n                table.parentNode.insertBefore(wrapper, table);\n                wrapper.appendChild(table);\n            });\n        }\n    </script>\n</body>\n</html>\nاجعل حاوية الاكواد في المنتصف، مع دعم scroll H\nلا اريد ازاحة نحو اليسار.","isUser":true,"timestamp":"2025-09-23T06:28:59.827243","imageUrls":[],"attachedFiles":[]},{"text":"لتلبية طلبك بجعل حاوية الأكواد في المنتصف مع دعم التمرير الأفقي ودون إزاحة نحو اليسار، سنقوم بتعديل تنسيقات `pre` داخل الفقاعة (`.bubble`) لإلغاء تأثير الهوامش الداخلية للفقاعة وجعل كتلة الكود تمتد على العرض الكامل المتاح للمحتوى، مما يعطيها مظهراً \"متوسطاً\" (filling the space) دون إزاحات غير مرغوبة.\n\nالإضافات والتعديلات المقترحة:\n\n1.  **في `.message.bot .bubble pre`**:\n    *   سنقوم بإزالة `margin: 16px 0;` الحالي.\n    *   سنضيف `margin-inline-start: -12px;` و `margin-inline-end: -12px;` لتعويض حشوة `padding: 12px;` الخاصة بالفقاعة من الجانبين (اليمين واليسار في سياق RTL).\n    *   سنغير `width` ليصبح `calc(100% + 24px);` لضمان أن كتلة الكود تمتد على عرض الفقاعة كاملاً (100% من المحتوى + 12px من كل جانب للحشوة).\n    *   سنعيد إضافة `margin-top` و `margin-bottom` للحفاظ على المسافة العمودية.\n    *   سنضيف `box-sizing: border-box;` لضمان أن الحشوة والحدود يتم تضمينها في حساب العرض.\n\nهذه التعديلات ستجعل كتلة الكود تمتد من حافة حقل الرسالة (بعد الأفاتار) إلى الحافة الأخرى، مما يزيل أي إزاحة داخلية ناتجة عن الفقاعة، ويعطيها مظهراً متوازناً و\"متوسطاً\" ضمن مساحة الرسالة. دعم التمرير الأفقي (`overflow-x: auto;`) موجود بالفعل على `code` داخل `pre`.\n\nإليك الكود المحدث:\n\n```html\n<!DOCTYPE html>\n<html lang=\"ar\" dir=\"rtl\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>عرض المحادثة</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js\"></script>\n\n    <style>\n        :root {\n            --bg-color: #f0f2f5; --text-color: #050505; --container-bg: #ffffff; --container-border: #e0e0e0; --header-bg: #f5f6f7; --header-border: #ddd; --bot-bubble-bg: transparent; --user-bubble-bg: #ECF2FE; --user-bubble-text: #050505; --timestamp-color: #65676b; --attachment-border: #ddd; --welcome-icon-filter: none;\n            --code-bg: #f6f8fa;\n            --code-header-bg: #eef0f2;\n            --code-text-color: #24292e;\n            --table-border-color: #e0e0e0;\n            --table-header-bg: #f9f9f9;\n            --table-row-hover: #f1f1f1;\n        }\n        .dark-mode {\n            --bg-color: #18191a; --text-color: #e4e6eb; --container-bg: #242526; --container-border: #3a3b3c; --header-bg: #3a3b3c; --header-border: #444; --bot-bubble-bg: transparent; --user-bubble-bg: #2A3C5C; --user-bubble-text: #e4e6eb; --timestamp-color: #b0b3b8; --attachment-border: #444;\n            --code-bg: #1e1e1e;\n            --code-header-bg: #333;\n            --code-text-color: #d4d4d4;\n            --table-border-color: #444;\n            --table-header-bg: #3a3b3c;\n            --table-row-hover: #4a4b4c;\n        }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n            background-color: var(--bg-color);\n            color: var(--text-color);\n            margin: 0;\n            height: 100vh;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .chat-container {\n            width: 100%;\n            max-width: 800px;\n            background-color: var(--container-bg);\n            border-radius: 8px;\n            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n            height: 100%;\n            max-height: 100vh;\n        }\n        .chat-header {\n            padding: 15px 20px;\n            border-bottom: 1px solid var(--header-border);\n            background-color: var(--header-bg);\n            text-align: center;\n            flex-shrink: 0;\n        }\n        .chat-header h1 {\n            margin: 0;\n            font-size: 15px;\n            font-weight: 600;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n        .chat-body {\n            flex-grow: 1;\n            overflow-y: auto;\n            padding: 10px 8px;\n        }\n        .message {\n            display: flex;\n            margin-bottom: 4px;\n            max-width: 95%;\n        }\n        .message.user {\n            margin-left: auto;\n            flex-direction: row-reverse;\n        }\n        .message.bot {\n            margin-right: auto;\n            align-items: flex-start;\n            gap: 8px;\n        }\n        .bot-avatar {\n            width: 28px;\n            height: 28px;\n            border-radius: 50%;\n            flex-shrink: 0;\n            margin-top: 4px;\n        }\n        .message-wrapper {\n            display: flex;\n            flex-direction: column;\n            max-width: 100%;\n            overflow: hidden;\n        }\n        .message.user .message-wrapper { align-items: flex-end; }\n        .message.bot .message-wrapper { align-items: flex-start; }\n        .bubble {\n            padding: 12px;\n            border-radius: 18px;\n            line-height: 1.5;\n            white-space: pre-wrap;\n            word-wrap: break-word;\n        }\n        .message.user .bubble {\n            background-color: var(--user-bubble-bg);\n            color: var(--user-bubble-text);\n        }\n        .message.bot .bubble {\n            background-color: var(--bot-bubble-bg);\n            color: var(--text-color);\n        }\n        .message.bot .bubble p { margin: 0 0 8px 0; }\n        .message.bot .bubble p:last-child { margin-bottom: 0; }\n        .message.bot .bubble ul, .message.bot .bubble ol { margin: 8px 0; padding-right: 20px; }\n        .message.bot .bubble li { margin-bottom: 4px; }\n        .message.bot .bubble a { color: #007bff; text-decoration: underline; }\n        .message.bot .bubble strong { font-weight: bold; }\n        .message.bot .bubble em { font-style: italic; }\n        .message.bot .bubble code {\n            font-family: 'monospace';\n            background-color: rgba(0,0,0,0.05);\n            padding: 2px 4px;\n            border-radius: 4px;\n        }\n        .dark-mode .message.bot .bubble code { background-color: rgba(255,255,255,0.1); }\n        .timestamp {\n            font-size: 0.75em;\n            color: var(--timestamp-color);\n            padding: 4px 12px;\n        }\n        .status-message {\n            text-align: center;\n            padding: 60px 20px;\n            color: var(--timestamp-color);\n            font-size: 1.1em;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            height: 100%;\n        }\n        .attachments-container {\n            padding: 0 12px;\n            margin-top: 8px;\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        }\n        .message-images {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 4px;\n            max-width: 250px;\n        }\n        .message-images img {\n            width: 120px;\n            height: 120px;\n            object-fit: cover;\n            border-radius: 16px;\n            border: 0.5px solid var(--attachment-border);\n            cursor: default;\n            transition: transform 0.2s;\n        }\n        .message-images img:hover {\n            transform: scale(1.05);\n        }\n        .file-attachment {\n            display: flex;\n            align-items: center;\n            padding: 10px 12px;\n            border-radius: 12px;\n            border: 0.5px solid var(--attachment-border);\n            width: 220px;\n            box-sizing: border-box;\n        }\n        .file-attachment img {\n            width: 40px;\n            height: 40px;\n            margin-left: 8px;\n        }\n        .file-info {\n            overflow: hidden;\n            flex-grow: 1;\n        }\n        .file-info .name {\n            font-size: 14px;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            color: var(--text-color);\n        }\n        .file-info .size {\n            font-size: 11px;\n            color: #65676b;\n        }\n        .dark-mode .file-info .size { color: #a0a0a0; }\n\n        /* --- بداية تنسيقات الجداول والأكواد --- */\n\n        /* حاوية الجداول لجعلها قابلة للتمرير الأفقي */\n        .table-wrapper {\n            overflow-x: auto;\n            margin: 1em 0;\n            border: 1px solid var(--table-border-color);\n            border-radius: 8px;\n        }\n        .message.bot .bubble table {\n            width: 100%;\n            border-collapse: collapse;\n            font-size: 0.9em;\n            min-width: 500px; /* يضمن أن الجدول لا ينضغط أكثر من اللازم */\n        }\n        .message.bot .bubble th, .message.bot .bubble td {\n            padding: 12px 15px;\n            text-align: right;\n            border-bottom: 1px solid var(--table-border-color);\n            white-space: nowrap; /* يمنع التفاف النصوص داخل الخلايا */\n        }\n        .message.bot .bubble th {\n            background-color: var(--table-header-bg);\n            font-weight: 600;\n            color: var(--text-color);\n        }\n        .message.bot .bubble tr:last-of-type td {\n            border-bottom: none;\n        }\n        .message.bot .bubble tr:hover {\n            background-color: var(--table-row-hover);\n        }\n\n        /* تنسيق بلوكات الأكواد */\n        .message.bot .bubble pre {\n            background-color: var(--code-bg);\n            border-radius: 8px;\n            /* margin: 16px 0;  -- تم إزالة الهامش الافتراضي */\n            overflow: hidden; /* لإخفاء زوايا code الداخلية */\n            direction: ltr;\n            position: relative;\n            border: 1px solid var(--table-border-color);\n\n            /* التعديلات الجديدة لجعل حاوية الأكواد في المنتصف ودون إزاحة */\n            width: calc(100% + 24px); /* توسيع العرض ليشمل حشوة الفقاعة (12px من كل جانب) */\n            margin-inline-start: -12px; /* تعويض حشوة الفقاعة من اليمين (بداية السطر في RTL) */\n            margin-inline-end: -12px;   /* تعويض حشوة الفقاعة من اليسار (نهاية السطر في RTL) */\n            margin-top: 16px; /* إعادة ضبط الهامش العلوي */\n            margin-bottom: 16px; /* إعادة ضبط الهامش السفلي */\n            box-sizing: border-box; /* التأكد من أن الحشوة والحدود تُحسب ضمن العرض */\n        }\n        .code-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            background-color: var(--code-header-bg);\n            padding: 8px 12px;\n            color: #586069;\n            font-size: 0.8em;\n            border-bottom: 1px solid var(--table-border-color);\n        }\n        .dark-mode .code-header {\n            color: #ccc;\n        }\n        .copy-button {\n            background-color: #f6f8fa;\n            color: #24292e;\n            border: 1px solid rgba(27, 31, 35, 0.15);\n            padding: 5px 10px;\n            border-radius: 5px;\n            cursor: pointer;\n            font-size: 0.9em;\n            transition: background-color 0.2s;\n        }\n        .dark-mode .copy-button {\n            background-color: #555;\n            color: white;\n            border-color: #666;\n        }\n        .copy-button:hover {\n            background-color: #eef0f2;\n        }\n        .dark-mode .copy-button:hover {\n            background-color: #666;\n        }\n        .copy-button.copied {\n            background-color: #28a745;\n            color: white;\n        }\n        .message.bot .bubble pre code {\n            display: block;\n            padding: 16px;\n            color: var(--code-text-color);\n            white-space: pre;\n            overflow-x: auto; /* هذا هو السطر المسؤول عن التمرير الأفقي للكود */\n            background-color: transparent;\n            font-family: 'SF Mono', 'Fira Code', 'Consolas', 'monospace';\n            font-size: 0.9em;\n            line-height: 1.6;\n        }\n        /* --- نهاية تنسيقات الجداول والأكواد --- */\n\n    </style>\n</head>\n<body>\n    <div class=\"chat-container\">\n        <div class=\"chat-header\"><h1 id=\"chat-title\">Think AI</h1></div>\n        <div class=\"chat-body\" id=\"chat-body\">\n            <!-- المحتوى سيتم إضافته هنا بواسطة JavaScript -->\n        </div>\n    </div>\n\n    <script>\n        document.addEventListener('DOMContentLoaded', function() {\n            const username = \"e-hr1\";\n            const repo = \"Think\";\n            const branch = \"main\";\n            const chatBody = document.getElementById('chat-body');\n            const chatTitle = document.getElementById('chat-title');\n\n            // التبديل للوضع المظلم بناءً على إعدادات النظام\n            const darkModeMatcher = window.matchMedia('(prefers-color-scheme: dark)');\n            function applyDarkMode(e) {\n                if (e.matches) {\n                    document.body.classList.add('dark-mode');\n                    document.querySelector('link[href*=\"highlight.js\"]').href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css';\n                } else {\n                    document.body.classList.remove('dark-mode');\n                    document.querySelector('link[href*=\"highlight.js\"]').href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';\n                }\n            }\n            darkModeMatcher.addListener(applyDarkMode);\n            applyDarkMode(darkModeMatcher);\n\n\n            const params = new URLSearchParams(window.location.search);\n            const chatId = params.get('id');\n\n            if (!chatId) {\n                window.location.href = 'welcome.html';\n                return;\n            }\n\n            chatBody.innerHTML = `<div class=\"status-message\"><p>جاري تحميل المحادثة...</p></div>`;\n            \n            const filePath = `public/chats/${chatId}.json`;\n            const fileUrl = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${filePath}`;\n\n            fetch(fileUrl)\n                .then(r => !r.ok ? new Promise(res => setTimeout(res, 1500)).then(() => fetch(fileUrl + '?t=' + new Date().getTime())) : r)\n                .then(r => { if (!r.ok) throw new Error(`فشل في العثور على المحادثة (الكود: ${r.status}).`); return r.json(); })\n                .then(conversation => displayConversation(conversation))\n                .catch(error => {\n                    console.error(error);\n                    const errorMessage = `حدث خطأ: ${error.message}`;\n                    window.location.href = `welcome.html?toast=${encodeURIComponent(errorMessage)}`;\n                });\n        });\n\n        function displayConversation(conversation) {\n            const chatTitle = document.getElementById('chat-title');\n            const chatBody = document.getElementById('chat-body');\n            chatTitle.textContent = conversation.title || 'محادثة';\n            chatBody.innerHTML = '';\n\n            if (!conversation.messages || conversation.messages.length === 0) {\n                const errorMessage = \"المحادثة فارغة أو تم حذفها.\";\n                window.location.href = `welcome.html?toast=${encodeURIComponent(errorMessage)}`;\n                return;\n            }\n\n            const username = \"e-hr1\";\n            const repo = \"Think\";\n            const branch = \"main\";\n            const botAvatarUrl = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/public/assets/icons/icon_thinkapp.png`;\n\n            function getIconUrl(fileType) {\n                const iconMap = {\n                    'pdf': 'icon_file_pdf.png', 'word': 'icon_word.png', 'excel': 'icon_exel.png',\n                    'pptx': 'icon_pptx.png', 'txt': 'icon_txt.png', 'code': 'icon_file_code.png'\n                };\n                const iconName = iconMap[fileType] || 'icon_file_code.png';\n                return `https://raw.githubusercontent.com/${username}/${repo}/${branch}/public/assets/icons/${iconName}`;\n            }\n\n            conversation.messages.forEach(msg => {\n                if (!msg.text && (!msg.imageUrls || msg.imageUrls.length === 0) && (!msg.attachedFiles || msg.attachedFiles.length === 0)) {\n                    return;\n                }\n\n                const messageEl = document.createElement('div');\n                messageEl.className = `message ${msg.isUser ? 'user' : 'bot'}`;\n\n                if (!msg.isUser) {\n                    const avatarImg = document.createElement('img');\n                    avatarImg.src = botAvatarUrl;\n                    avatarImg.className = 'bot-avatar';\n                    messageEl.appendChild(avatarImg);\n                }\n\n                const wrapperEl = document.createElement('div');\n                wrapperEl.className = 'message-wrapper';\n\n                const attachmentsEl = document.createElement('div');\n                attachmentsEl.className = 'attachments-container';\n\n                if (msg.imageUrls && msg.imageUrls.length > 0) {\n                    const imagesContainer = document.createElement('div');\n                    imagesContainer.className = 'message-images';\n                    if (msg.isUser) { imagesContainer.style.justifyContent = 'flex-end'; }\n                    msg.imageUrls.forEach(url => {\n                        const img = document.createElement('img');\n                        img.src = url;\n                        img.alt = 'صورة مرفقة';\n                        imagesContainer.appendChild(img);\n                    });\n                    attachmentsEl.appendChild(imagesContainer);\n                }\n\n                if (msg.attachedFiles && msg.attachedFiles.length > 0) {\n                    msg.attachedFiles.forEach(file => {\n                        const fileDiv = document.createElement('div');\n                        fileDiv.className = 'file-attachment';\n                        fileDiv.innerHTML = `\n                            <img src=\"${getIconUrl(file.type)}\" alt=\"${file.type} icon\">\n                            <div class=\"file-info\">\n                                <div class=\"name\">${file.name}</div>\n                                <div class=\"size\">${file.size}</div>\n                            </div>`;\n                        attachmentsEl.appendChild(fileDiv);\n                    });\n                }\n                \n                if (msg.isUser) { wrapperEl.appendChild(attachmentsEl); }\n\n                if (msg.text && msg.text.trim() !== '') {\n                    const bubbleEl = document.createElement('div');\n                    bubbleEl.className = 'bubble';\n                    \n                    if (msg.isUser) {\n                        bubbleEl.textContent = msg.text;\n                    } else {\n                        bubbleEl.innerHTML = marked.parse(msg.text, {\n                            highlight: function(code, lang) {\n                                const language = hljs.getLanguage(lang) ? lang : 'plaintext';\n                                return hljs.highlight(code, { language, ignoreIllegals: true }).value;\n                            }\n                        });\n                    }\n                    \n                    wrapperEl.appendChild(bubbleEl);\n                }\n                \n                if (!msg.isUser) { wrapperEl.appendChild(attachmentsEl); }\n\n                const timestampEl = document.createElement('div');\n                timestampEl.className = 'timestamp';\n                timestampEl.textContent = new Date(msg.timestamp).toLocaleString('ar-SA', { hour: 'numeric', minute: 'numeric', hour12: true });\n                wrapperEl.appendChild(timestampEl);\n\n                messageEl.appendChild(wrapperEl);\n                chatBody.appendChild(messageEl);\n            });\n\n            // استدعاء الدوال لتحسين عرض الأكواد والجداول\n            enhanceCodeBlocks();\n            wrapTables();\n        }\n\n        function enhanceCodeBlocks() {\n            document.querySelectorAll('.message.bot .bubble pre').forEach(preElement => {\n                if (preElement.querySelector('.code-header')) return; // تجنب إضافة الهيدر مرتين\n\n                const codeElement = preElement.querySelector('code');\n                if (!codeElement) return;\n\n                const langClass = Array.from(codeElement.classList).find(c => c.startsWith('language-'));\n                const lang = langClass ? langClass.replace('language-', '') : 'code';\n\n                const header = document.createElement('div');\n                header.className = 'code-header';\n\n                const langName = document.createElement('span');\n                langName.textContent = lang;\n\n                const copyButton = document.createElement('button');\n                copyButton.className = 'copy-button';\n                copyButton.textContent = 'نسخ';\n\n                header.appendChild(langName);\n                header.appendChild(copyButton);\n\n                preElement.insertBefore(header, preElement.firstChild);\n\n                copyButton.addEventListener('click', () => {\n                    navigator.clipboard.writeText(codeElement.innerText).then(() => {\n                        copyButton.textContent = 'تم النسخ!';\n                        copyButton.classList.add('copied');\n                        setTimeout(() => {\n                            copyButton.textContent = 'نسخ';\n                            copyButton.classList.remove('copied');\n                        }, 2000);\n                    });\n                });\n            });\n        }\n\n        function wrapTables() {\n            document.querySelectorAll('.message.bot .bubble table').forEach(table => {\n                if (table.parentNode.classList.contains('table-wrapper')) return;\n                const wrapper = document.createElement('div');\n                wrapper.className = 'table-wrapper';\n                table.parentNode.insertBefore(wrapper, table);\n                wrapper.appendChild(table);\n            });\n        }\n    </script>\n</body>\n</html>\n```","isUser":false,"timestamp":"2025-09-23T06:28:59.827256","imageUrls":[],"attachedFiles":[]},{"text":"اين الكلاس حق رسالة ai","isUser":true,"timestamp":"2025-09-23T06:32:19.794824","imageUrls":[],"attachedFiles":[]},{"text":"الكلاس الرئيسي الذي يميز رسالة الذكاء الاصطناعي (AI) عن رسائل المستخدم هو:\n\n*   **`.message.bot`**: هذا الكلاس يُضاف إلى العنصر `div` الذي يمثل رسالة كاملة من الذكاء الاصطناعي (البوت). هو الذي يحدد اتجاه الرسالة وكيفية محاذاتها (في هذا الكود، `margin-right: auto;` يضعها على اليمين في وضع RTL).\n\nأما المحتوى الفعلي لفقاعة الرسالة (النص والجداول والأكواد) فهو ضمن كلاس:\n\n*   **`.message.bot .bubble`**: هذا الكلاس يستهدف الفقاعة التي تحتوي على نص الرسالة عندما تكون من الذكاء الاصطناعي. وهو الذي يحدد الخلفية واللون والتنسيق الداخلي للمحتوى.\n\nبالإضافة إلى ذلك، هناك:\n\n*   **`.bot-avatar`**: هذا الكلاس خاص بصورة الأفاتار (الصورة الشخصية) للذكاء الاصطناعي.\n\nإذًا، **`.message.bot`** هو الكلاس الأساسي الذي تعرف من خلاله أن هذه الرسالة قادمة من الذكاء الاصطناعي.","isUser":false,"timestamp":"2025-09-23T06:32:19.794859","imageUrls":[],"attachedFiles":[]}]}